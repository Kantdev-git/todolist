/* JS Index */
document.addEventListener("DOMContentLoaded",()=>{document.getElementById("total").style.display="block",firebase.auth().onAuthStateChanged(function(e){if(e){userId=e.uid,console.log(userId),$("#etatConnexion").css("color","green"),$("#etatConnexion").html('En ligne  <i class="fas fa-circle"></i>');let c=[],r=[],d=[],l=[];firebase.database().ref("users/"+userId+"/tasks").once("value").then(function(e){e.val()?c=e.val():(c=[],$("input[value=recent]").prop("checked",!0)),t()}).catch(e=>{alert("Code :"+e.code+"\nMessage :"+e.message)}),firebase.database().ref("users/"+userId+"/heure").once("value").then(function(e){r=e.val()?e.val():[],t()}).catch(e=>{alert("Code :"+e.code+"\nMessage :"+e.message)}),firebase.database().ref("/users/"+userId+"/tasksFinished/").once("value").then(function(e){d=e.val()?e.val():[]}).catch(e=>{alert("Code :"+e.code+"\nMessage :"+e.message)}),firebase.database().ref("/users/"+userId+"/heureFinished/").once("value").then(function(e){l=e.val()?e.val():[],a()}).catch(e=>{alert("Code :"+e.code+"\nMessage :"+e.message)}),a();const o=document.getElementById("taskForm");function t(){const e=document.getElementById("tasksContainer");e&&(e.innerHTML="",0==c?document.getElementById("no-task").innerText="Vous n'avez pas de tâches":(document.getElementById("no-task").innerText="",document.getElementById("zone-tri").style.display="block"),c.forEach((i,o)=>{const u=document.createElement("div");u.id="task"+(o+1),u.className="oneTask",e.appendChild(u);const m=document.createElement("div");m.id="task"+o,m.className="zone-text ",u.appendChild(m);const h=document.createElement("p");m.appendChild(h),h.innerText=i,h.className="text-task ";const k=document.createElement("p");m.appendChild(k),k.innerText="Créer le  "+r[o],k.className="date-task";const v=document.createElement("div");u.appendChild(v),v.id="del"+o,v.className="trash-task",v.innerHTML=' <i class="kantdev-btn btn__primary fas fa-check"></i>',v.addEventListener("click",()=>{let e,u,m,h=new Date;switch(minutesFinished=h.getMinutes(),h.getMonth()){case 0:u="janvier";break;case 1:u="février";break;case 2:u="mars";break;case 3:u="avril";break;case 4:u="mai";break;case 5:u="juin";break;case 6:u="juillet";break;case 7:u="aôut";break;case 8:u="septembre";break;case 9:u="octobre";break;case 10:u="novembre";break;case 11:u="décembre"}switch(h.getDay()){case 0:e="dimanche ";break;case 1:e="lundi ";break;case 2:e="mardi ";break;case 3:e="mercredi ";break;case 4:e="jeudi ";break;case 5:e="vendredi ";break;case 6:e="samedi "}m=h.getMinutes()<10?e+h.getDate()+" "+u+" à "+h.getHours()+"h0"+h.getMinutes():e+h.getDate()+" "+u+" à "+h.getHours()+"h"+h.getMinutes(),l.splice(0,0,m),d.splice(0,0,i),a(),s(),c.splice(o,1),r.splice(o,1),t(),n(),$("#validerTask").css("visibility","visible"),document.getElementById("validerTask").innerText="Tâche archivée",document.getElementById("validerTask").style.color="red",window.setTimeout(()=>{$("#validerTask").css("visibility","hidden")},2e3),$("#taskFinished").css("visibility","visible"),document.getElementById("taskFinished").innerText="Tâche ajoutée aux archives",document.getElementById("taskFinished").style.color="green",window.setTimeout(()=>{$("#taskFinished").css("visibility","hidden")},2e3)})})),document.getElementById("total").style.display="none"}function a(){const e=document.getElementById("tasksContainerFinished");e&&(e.innerHTML="",d.forEach((t,i)=>{const c=document.createElement("div");c.id="taskFinish"+i,c.className="task-finish",e.appendChild(c);const r=document.createElement("div");r.id="task"+i,r.className="zone-text ",c.appendChild(r);const o=document.createElement("p");r.appendChild(o),o.innerText=t,o.className="text-task";const u=document.createElement("p");r.appendChild(u),u.innerText="Tâche fini le  "+l[i],u.className="date-task";const m=document.createElement("div");c.appendChild(m),m.id="delFinish"+i,m.className="trash-task",m.innerHTML=' <i class="kantdev-btn btn__primary  far fa-trash-alt"></i>',m.addEventListener("click",()=>{d.splice(i,1),l.splice(i,1),n(),s(),a(),$("#taskFinished").css("visibility","visible"),document.getElementById("taskFinished").innerText="Tâche supprimée des archives",document.getElementById("taskFinished").style.color="red",window.setTimeout(()=>{$("#taskFinished").css("visibility","hidden")},2e3)})}),""==d?(document.getElementById("taskFinished").innerText="",document.getElementById("no-historique").innerText="Vous n'avez pas d'historique"):document.getElementById("no-historique").innerText="")}function s(){firebase.database().ref("users/"+userId+"/tasksFinished").set(d).then(()=>{}).catch(e=>{alert("Code :"+e.code+"\nMessage :"+e.message)}),firebase.database().ref("users/"+userId+"/heureFinished").set(l).then(()=>{}).catch(e=>{alert("Code :"+e.code+"\nMessage :"+e.message)})}function n(){firebase.database().ref("users/"+userId+"/heure").set(r).then(()=>{document.getElementById("validerTask").innerText="Tâche inscrite",document.getElementById("validerTask").style.color="green",document.getElementById("taskInput").addEventListener("keypress",()=>{document.getElementById("validerTask").innerText=""})}).catch(e=>{alert("Code :"+e.code+"\nMessage :"+e.message)}),firebase.database().ref("users/"+userId+"/tasks").set(c).then(()=>{document.getElementById("validerTask").innerText="Tâche inscrite",document.getElementById("validerTask").style.color="green",document.getElementById("taskInput").addEventListener("keypress",()=>{document.getElementById("validerTask").innerText=""})}).catch(e=>{alert("Code :"+e.code+"\nMessage :"+e.message)})}function i(){firebase.database().ref("users/"+userId+"/reverse/val").once("value").then(function(e){t(),$("input[value='"+e.val()+"']").prop("checked",!0)}).catch(e=>{alert("Code :"+e.code+"\nMessage :"+e.message)})}$('input[name="radio2"]').on(" change",function(e){"recent"==$('input[name="radio2"]:checked').val()&&(c.reverse(),r.reverse(),t()),"ancien"==$('input[name="radio2"]:checked').val()&&(c.reverse(),r.reverse(),t())}),i(),c.reverse(),r.reverse(),o.addEventListener("submit",e=>{e.preventDefault(),function(){let e=$('input[name="radio2"]:checked').val();firebase.database().ref("users/"+userId+"/reverse/val").set(e).then(()=>{}).catch(e=>{alert("Code :"+e.code+"\nMessage :"+e.message)})}(),document.getElementById("total").style.display="block";const a=e.target.elements;let s,d,l,o=new Date;switch(minutes=o.getMinutes(),o.getMonth()){case 0:d="janvier";break;case 1:d="février";break;case 2:d="mars";break;case 3:d="avril";break;case 4:d="mai";break;case 5:d="juin";break;case 6:d="juillet";break;case 7:d="aôut";break;case 8:d="septembre";break;case 9:d="octobre";break;case 10:d="novembre";break;case 11:d="décembre"}switch(o.getDay()){case 0:s="dimanche ";break;case 1:s="lundi ";break;case 2:s="mardi ";break;case 3:s="mercredi ";break;case 4:s="jeudi ";break;case 5:s="vendredi ";break;case 6:s="samedi "}l=o.getMinutes()<10?s+o.getDate()+" "+d+" à "+o.getHours()+"h0"+o.getMinutes():s+o.getDate()+" "+d+" à "+o.getHours()+"h"+o.getMinutes(),"recent"==$('input[name="radio2"]:checked').val()?(c.splice(0,0,a.task.value),r.splice(0,0,l)):"ancien"==$('input[name="radio2"]:checked').val()&&(c.push(a.task.value),r.push(l)),t(),n(),$("#validerTask").css("visibility","visible"),document.getElementById("validerTask").innerText="Tâche créée",document.getElementById("validerTask").style.color="green",window.setTimeout(()=>{$("#validerTask").css("visibility","hidden")},2e3),e.target.reset(),i()})}else window.location="signIn.html"})});